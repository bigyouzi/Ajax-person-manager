<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <!-- ie 按照 最新的 方式渲染 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- 视口 -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap 101 Template</title>

  <!-- Bootstrap -->
  <!--<link href="lib/css/bootstrap.min.css" rel="stylesheet">-->
  <!-- bootstrap的 样式 -->
  <link href="lib/css/bootstrap.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!-- 兼容 ie9
    html5shiv html5的新语义标签
    respond 低版本的ie中 不支持 媒体查询 @media
   -->
  <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <style>
    h1 {
      border-bottom: 1px solid #ccc;
      padding-bottom: 20px;
    }

    .zombie-panel table th {
      text-align: center;
      background-color: #eee;
    }

    .zombie-panel table td {
      text-align: center;
    }
    /* 清除 底部的样式 */

    .zombie-panel .pagination {
      margin: 0;
    }

    .zombie-panel {
      position: relative;
    }

    #editModal .modal-dialog {
      position: relative;
    }

    #coverModal {
      background: url('img/loading.gif')no-repeat center;
    }

    a.disabled {
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <!-- 最外层的容器 -->
  <div class="container">
    <!-- 顶部标题 -->
    <h1>人员管理_自己的<small>--版本9.0</small></h1>
    <!-- 面板 -->
    <div class="zombie-panel panel panel-default">
      <!-- 顶部 -->
      <div class="panel-heading">
        <h3 class="panel-title">信息列表</h3>
      </div>
      <!-- 内容区域 -->
      <div class="panel-body">
        <!-- 表格 -->
        <table class="table table-bordered">
          <thead>
            <tr>
              <th width='10%'>序号</th>
              <th width='15%'>姓名</th>
              <th width='15%'>年龄</th>
              <th width='20%'>学校</th>
              <th width='20%'>操作</th>
            </tr>
          </thead>
          <tbody>
            <!--<tr>
              <td>1</td>
              <td>水桶僵尸</td>
              <td>18</td>
              <td>zombie1</td>
              <td>僵尸大学</td>
              <td>
                <button class='btn btn-default btn-xs glyphicon glyphicon-remove'></button>
                <button class='btn btn-default btn-xs glyphicon glyphicon-edit'></button>
              </td>
            </tr>-->
          </tbody>
        </table>
      </div>
      <!-- 底部区域 -->
      <div class="panel-footer">
        <nav class='clearfix' aria-label="Page navigation">
          <!-- 分页器 -->
          <ul class="pagination pull-right">
            <li>
              <a href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            <li><a href="#">1</a></li>
            <li><a href="#">/</a></li>
            <li><a href="#">1</a></li>
            <li>
              <a href="javascript:void(0)" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
          <!-- 新增按钮 -->
          <button data-toggle="modal" data-target="#addModal" class='btn btn-danger'>新增</button>
        </nav>
      </div>
    </div>
  </div>

  <!-- 新增模态框 #addModal -->
  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">新增窗口</h4>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="addname">姓名</label>
              <input type="text" name='name' class="form-control" id="addname" placeholder="请输入真实姓名">
            </div>
            <div class="form-group">
              <label for="addpassword">密码</label>
              <input type="password" name='password' class="form-control" id="addpassword" placeholder="请输入密码">
            </div>
            <div class="form-group">
              <label for="addschool">学校</label>
              <input type="text" class="form-control" name='school' id="addschool" placeholder="请输入学校">
            </div>
            <div class="form-group">
              <label for="addage">年龄</label>
              <input type="text" name='age' class="form-control" id="addage" placeholder="请输入年龄">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">保&nbsp;存</button>
        </div>
      </div>
    </div>
  </div>
  <!-- 修改模态框模态框 #addModal -->
  <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">修改窗口</h4>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="editname">姓名</label>
              <input type="text" name='name' class="form-control" id="editname" placeholder="请输入真实姓名">
            </div>
            <div class="form-group">
              <label for="editpassword">密码</label>
              <input type="password" name='password' class="form-control" id="editpassword" placeholder="请输入密码">
            </div>
            <div class="form-group">
              <label for="editschool">学校</label>
              <input type="text" class="form-control" name='school' id="editschool" placeholder="请输入学校">
            </div>
            <div class="form-group">
              <label for="editage">年龄</label>
              <input type="text" name='age' class="form-control" id="editage" placeholder="请输入年龄">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">保存</button>
        </div>
      </div>
    </div>
  </div>
  <!-- 删除模态框 #removeModal -->
  <div class="modal fade" id="removeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">删除窗口</h4>
        </div>
        <div class="modal-body">
          <h2>你真的想清楚了，删了可就没有了哦😁</h2>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal">我想好了</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 遮挡用 模态框  -->
  <div class="modal fade" id="coverModal" tabindex="-1" role="dialog" data-backdrop='static' aria-labelledby="myModalLabel">
  </div>
</body>

</html>
<!--  jQ  -->
<script src="./lib/js/jquery-1.12.4.js"></script>
<!-- bs的js -->
<script src="./lib/js/bootstrap.min.js"></script>
<!-- 模板引擎 -->
<script src="./lib/js/template-web.js"></script>
<!-- 定义模板 -->
 <script type='text/html' id="template">
    {{each list}}
  <tr>
    <td>{{$value.id}}</td>
    <td>{{$value.name}}</td>
    <td>{{$value.age}}</td>
    <td>{{$value.school}}</td>
    <td>
      <button data-toggle="modal" data-target="#removeModal" class="btn btn-default btn-xs glyphicon glyphicon-remove"></button>
      <button class="btn btn-default btn-xs glyphicon glyphicon-edit"></button>
    </td>
  </tr>
  {{/each}}
 </script>
<!-- 
    导入的文件
      jQ
      bootstrap的js
      模板引擎

    需求们
      需求1 页面打开获取数据 第一页
          页面dom元素创建完毕 入口函数  jQuery
            弹出遮罩层 modal 
            无刷新获取数据  ajax
              数据请求回来之后  回调函数
                关闭遮罩层 modal
                渲染到页面上 art-template - 引入 - 挖坑 - 起名字 - 填坑 - 添加
                计算总页数 根据返回的数据 自己计算
      需求2 点击下一页 获取下一页的数据
            准备变量 记录页码
            点击的时候 翻页
              判断是否有disabled 类名 有 
                提示用户 
                return
              页码++
              弹出遮罩层
              无刷新获取数据
                数据请求回来之后
                  关闭遮罩层
                  渲染到页面上
                  修改当前页
                  如果是最后一页 
                    禁用下一页点击
      需求3 点击上一页 获取上一页的数据
            准备变量 记录页码
            点击的时候 翻页
              判断是否有disabled 类名 有 
                提示用户 
                return
              页码--
              弹出遮罩层
              无刷新获取数据
                数据请求回来之后
                  关闭遮罩层
                  渲染到页面上
                  修改当前页
                  如果是第一页 
                    禁用上一页点击
      需求4 点击删除按钮 删除这一行
          变量  删除id
          绑定给 tbody 点击事件 让内部的 删除按钮触发
            获取点击的x 对应的 序号即可
            把获取到的id 保存到 定义的变量中
          绑定给删除弹框的 确认按钮
            无刷新删除数据 跟上面的点击事件共享一个 id
              使用变量 删除id 调用 删除接口即可
                接口调用成功 回调函数触发之后 
      需求5 点击新增弹框的 新增按钮 新增数据
            绑定点击事件
              无刷新 新增数据 ajax
                调用 jQuery的 格式化表单的代码
                数据新增成功之后
                  再次获取 当前这一页的数据
                    getData();
      需求6 点击页面中的 编辑框 获取当前这一条数据
           绑定点击事件 tbody 指定 编辑按钮触发
           弹出遮罩层
           获取当前这一行的id
              无刷新 获取这一行的数据 ajax
                  请求响应回来之后
                    修改修改框框的内容
                    弹出修改框框
      需求7 点击编辑框的保存按钮 提交数据
            绑定点击事件
              无刷新提交数据
                数据提交成功之后
                  重新获取当前这一页的数据
                    getData();


 -->
<script>
  var mypage = 1;
  function getData(){
    $('#coverModal').modal('show');
    $.ajax({
      url:'http://127.0.0.1/ajax/2017-8-18/00.API/api_cors/findUsers.php',
      data:{
        pageNum:mypage,
        pageSize:4
      },
      success:function(data){
        console.log(data);
        $('#coverModal').modal('hide');
        $('tbody').html(template('template',data));
        var totalPage = Math.ceil(data.total/data.pageSize);
        $('.pagination li:eq(3) a').html(totalPage);
        $('.pagination li:eq(1) a').html(data.pageNum);
        if(data.pageNum==totalPage)
        {
          $('a[aria-label="Next"]').addClass('disabled');
        }
        else
        {
          $('a[aria-label="Next"]').removeClass('disabled');
        }
        if(data.pageNum== 1)
        {
          $('a[aria-label="Previous"]').addClass('disabled');
        }
        else{
          $('a[aria-label="Previous"]').removeClass('disabled');
        }
      }
    })
  }
  $(function(){
    //打开网页加载数据
    getData();
    //下一页获取新数据，当且仅当到最后一页时给右标签禁用
    $('a[aria-label="Next"]').click(function(){
      if($(this).hasClass('disabled'))
      {
        alert('the last page!!!');
        return;
      }
      mypage++;
      getData();
    })
    //上一页获取新数据，当且仅当到第一页时给左标签禁用
    $('a[aria-label="Previous"]').click(function(){
      if($(this).hasClass('disabled'))
      {
        alert('the first page!!!');
        return;
      }
      mypage--;
      getData();
    })
    //删除数据
    var removeID;
    $('tbody').on('click', '.glyphicon-remove', function(){
      removeID = $(this).parent().siblings().first().html();
      // console.log(removeID)
    })
    //确认删除
    $("#removeModal .btn-danger").click(function(){
      $('#coverModal').modal('show');
      // console.log(removeID)
      $.ajax({
        url:'http://127.0.0.1/2017-8-18/00.API/api_cors/removeUser.php',
        type:'post',
        data:{
          id:removeID
        },
        success:function(data){
          // console.log(data)
          getData();
        }
      })
    })
    //新增数据
    $('#addModal .btn-primary').click(function(){
      $('#coverModal').modal('show'); 
      //jQuery格式化表单方法serialize()返回的数据格式为
      //key1=value1&key2=value2
      var newdata = $('#addModal form').serialize();
      $.ajax({
        url:'http://127.0.0.1/2017-8-18/00.API/api_cors/saveUser.php',
        type:'post',
        data:newdata,
        success:function(data){
          // console.log(data)
          getData();
        }
      })
    })
    //编辑数据
    var editID;
    $('tbody').on('click','.glyphicon-edit',function(){
      $('#coverModal').modal('show'); 
      editID = $(this).parent().siblings().first().html();
      // console.log(editID)
      $.ajax({
        url:'http://127.0.0.1/2017-8-18/00.API/api_cors/getOneUser.php',
        data:{
          id:editID
        },
        success:function(data){
          // console.log(data)
          $('#coverModal').modal('hide'); 
          $('#editModal form input[name=name]').val(data.list[0].name);
          $('#editModal form input[name=password]').val(data.list[0].password);
          $('#editModal form input[name=school]').val(data.list[0].school);
          $('#editModal form input[name=age]').val(data.list[0].age);
          $('#editModal').modal('show');
        }
      })
    })
    //保存编辑
    $('#editModal .btn-primary').click(function(){
      $('#coverModal').modal('show'); 
      var sendData = $('#editModal form').serialize();
      sendData = sendData +'&id=' + editID;
      console.log(sendData);
      $.ajax({
        url:'http://127.0.0.1/2017-8-18/00.API/api_cors/modifyUser.php',
        type:'post',
        data:sendData,
        success:function(data){
          // console.log(data)
          getData()
        }
      })
    })
  })
</script>